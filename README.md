# SigmaLabs Contract Generator

## Prerequisites:
- Create a Google Cloud Console project:
    - Equip the Google doc API
    - Equip the Google drive API
    - Create Service Account and create a new key
- Before running any `generate*.js` script. Remember to share the Google doc with the Service Account email. These must be Google documents and **not** word documents. You must save those with .docx, .doc etc. extensions as a Google doc first.

Note: none of the files use any libraries excpet sometimes `fs`, therefore, scripts can be run using almost any tool. For developement they have been tested using `node.js`.

## Generating Letters using Single File

The letters can be generated by running the single `generateContractsOneFile.js`. This file using no dependencies.
This will:
1. Generate access token based on service account credentials
2. Copy the offer letter termplate and replace strings in the file
3. Share the new document with the email you specify in the file.
4. Same for steps 2-3 but for training agreement template
5. Print the urls of the new docs.

Smpliy fill out the placeholder and empty details at the begining of the script:
```bash
// ========== Candidate information ==========
const firstName = "Michael";  // These are placeholder values
const lastName = "Brown";
const streetAddress = "50 Oak Street";
const city = "Liverpool";
const postCode = "L1 5AB";
const courseStartDate = "8th July";

// ========== Sensitive information ==========
const serviceAccountPemKey = "<service_account_pem_key>";
const serviceAccountEmail = "<service_account_email>";

const offerLetterDocTemplateId = "<offer_letter_template_id>";  // Can be found in doc url
const trainingAgreementLetterTemplateId = "training_agreement_template_id";
const emailToShareWith = "<your_email>";
```
### Extracting Google Doc ID
Google Document IDs can be extracted from their URLs.  
For example, in the URL `https://docs.google.com/document/d/1abcdEfGhIjKlMnOpQrStUvWxYz1234567890/edit`, the document ID is the portion after `/d/` and before `/edit` (`1abcdEfGhIjKlMnOpQrStUvWxYz1234567890`).

## Setup Sensitive Data Files

Running the other files (`generateOfferLetter.js`, `generateTrainingAgreement.js`, `getAccessToken.js`) will require the setup seen below.

1. Download the Service Account credentials and save as `neat-chain.json`  
    make sure at least the following are in the file:
    ```
    {
        "private_key": <pem_key>,
        "client_email": <service_account_email>,
    }
    ```

2. Run `getAccessToken.js` to obtain access token.

3. Create credentials.json and fill with:
    ```
    {
        "access_token": "<your_access_token>",
        "training_fees_agreement_template_id": "<document_template_id>",
        "offer_letter_template_id": "<document_template_id>",
        "share_email": "<email_to_share_generated_documents_with>"
    }
    ```

4. Add these `.json` files to the gitignore.

## Notes
At the moment candidate details are pulled from `candidate-details.json` using the `getCandidateDetails()` function in `utils/miscUtils.js` but these details can be introduced in script which ever way is convenient as long as the following information is present:
- `firstName`
- `lastName`
- `streetAddress`
- `city`
- `postCode`
- `courseStartDate` (in the format e.g. 8th July)


## Files
- `generateContractsOneFile.js` - File to run all functions under one script. Useful for adpation to Airtable automations.
- `generateOfferLetter.js` - Copies `training_fees_agreement_template_id` word doc template and replaces string with specified candidate information.
- `generateTrainingAgreement.js`- Copies `offer_letter_template_id` word doc template and replaces string with specified candidate information.
- `getAccessToken.js` - Can be used to generated a new access code/token for a given Service Account.
- `utils/`
    - `dateUtlis.js` - Some date functions to get current date and reformat in different ways.
    - `miscUtils.js` - Miscellaneous but useful functions to aid contract generation.
- `candidate-data.json` - Sample file with fake candidate information.